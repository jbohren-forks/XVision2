<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/burschka/XVision2-2.0.0/src/Images/XVImageBase.icc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.0 on Fri Oct 26 00:17:16 2007 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/home/burschka/XVision2-2.0.0/src/Images/XVImageBase.icc</h1><div class="fragment"><pre>00001 <font class="comment">// *** BEGIN_XVISION2_COPYRIGHT_NOTICE ***</font>
00002 <font class="comment">// *** END_XVISION2_COPYRIGHT_NOTICE ***</font>
00003 
00004 <font class="preprocessor">#ifndef _XVIMAGEBASE_ICC_
</font>00005 <font class="preprocessor"></font><font class="preprocessor">#define _XVIMAGEBASE_ICC_
</font>00006 <font class="preprocessor"></font>
00007 <font class="preprocessor">#include &lt;iostream&gt;</font>
00008 <font class="preprocessor">#include &lt;math.h&gt;</font>
00009 
00010 <font class="preprocessor">#include &lt;XVTools.h&gt;</font>
00011 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00012 
00013 <font class="keyword">using</font> <font class="keyword">namespace</font> std ;
00014 
00024 <font class="keyword">template</font>&lt;<font class="keyword">class </font>T&gt;
00025 <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt;&amp; copyImage( <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt;&amp; src, <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt;&amp; targ )<font class="keyword"> </font>{
00026   <font class="keyword">const</font> <font class="keywordtype">int</font> w = src.Width(), h = src.Height() ;
00027   targ.resize( w, h );
00028   <font class="keyword">const</font> T * sp = src.data() ;
00029   T * tp = targ.lock() ;
00030   <font class="keywordtype">int</font> ss = src.Skip(), ts = targ.Skip() ;
00031   <font class="keywordflow">if</font>( ss || ts ) { <font class="comment">// copy line by line</font>
00032     <font class="keywordflow">for</font>( <font class="keywordtype">int</font> i = 0 ; i &lt; h ; i ++ ) {
00033       memcpy( tp, sp, w*<font class="keyword">sizeof</font>(T) );
00034       sp += w + ss ;
00035       tp += w + ts ;
00036     }
00037   }<font class="keywordflow">else</font> { <font class="comment">// no Skip(), copy at once</font>
00038     memcpy( tp, sp, w*h*<font class="keyword">sizeof</font>(T) );
00039   }
00040   targ.unlock() ;
00041   <font class="keywordflow">return</font> targ ;
00042 }
00043 
00047 <font class="keyword">template</font>&lt;<font class="keyword">class </font>I&gt;
00048 I copyImage( <font class="keyword">const</font> I&amp; src )<font class="keyword"> </font>{
00049   I targ ;
00050   copyImage( src, targ );
00051   <font class="keywordflow">return</font> targ ;
00052 }
00053 
00054 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00055 <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; resample (<font class="keywordtype">float</font> factorX, <font class="keywordtype">float</font> factorY,
00056                       <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; src,
00057                       <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; target)<font class="keyword"></font>{
00058   
00059   <a class="code" href="class_XVSize.html">XVSize</a> targSize((round (src.Width() * factorX)), 
00060             (round(src.Height() * factorY)));
00061   target.resize(targSize);
00062 
00063   XVRowIterator&lt;T&gt;  srcIter (src);
00064   XVRowWIterator&lt;T&gt; targIter (target);
00065 
00066   <font class="keywordtype">float</font> addXf = 1 / factorX;
00067   <font class="keywordtype">float</font> addYf = 1 / factorY;
00068 
00069   <font class="comment">// use fast version if possible</font>
00070   <font class="keywordflow">if</font>((addXf - ((<font class="keywordtype">int</font>)addXf)) == 0 &amp;&amp; (addYf - ((<font class="keywordtype">int</font>)addYf)) == 0){
00071 
00072     <font class="keywordtype">int</font> addX = (<font class="keywordtype">int</font>)addXf;  <font class="keywordtype">int</font> addY = (<font class="keywordtype">int</font>)addYf;
00073 
00074     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> r = 0, sr = 0; r &lt; target.Height(); ++r, sr += addY){
00075       targIter.reset( r );
00076       srcIter.reset( sr );
00077       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> c = 0; !targIter.end(); ++targIter, srcIter += addX){   
00078      *targIter = *srcIter;
00079       }
00080     }
00081   }<font class="keywordflow">else</font>{
00082 
00083     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> r = 0; r &lt; target.Height(); ++r) {
00084       targIter.reset( r );
00085       srcIter.reset( (<font class="keywordtype">int</font>)round(r/factorY) );      
00086       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> c = 0, nc = 0, pc = 0; !targIter.end(); ++targIter, 
00087                                                         ++c, 
00088                                                    nc = round(c / factorX),
00089                                                    srcIter += nc - pc,
00090                                                         pc = nc){
00091 
00092      *targIter = *srcIter;
00093       }
00094     }
00095   }
00096 
00097   <font class="keywordflow">return</font> target;
00098 };
00099   
00100 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00101 <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; resample(<font class="keywordtype">int</font> factor, <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; src, 
00102                  <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; targ)<font class="keyword"></font>{
00103   <font class="keywordflow">return</font> resample(factor, factor, src, targ);
00104 };
00105 
00106 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00107 T resample(<font class="keywordtype">int</font> factor, <font class="keyword">const</font> T &amp; src)<font class="keyword"></font>{
00108   T newImage(src.Width(), src.Height());
00109   resample(factor, src, newImage);
00110   <font class="keywordflow">return</font> newImage;
00111 };
00112 
00113 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00114 T resample(<font class="keywordtype">int</font> factorX, <font class="keywordtype">int</font> factorY, <font class="keyword">const</font> T &amp; src)<font class="keyword"></font>{
00115   T newImage(src.Width(), src.Height());
00116   resample(factorX, factorY, src, newImage);
00117   <font class="keywordflow">return</font> newImage;
00118 };
00119 
00120 
00127 <font class="keyword">template</font> &lt;<font class="keyword">class </font>S, <font class="keyword">class </font>T&gt;
00128 <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; resample (<font class="keywordtype">float</font> factorX, <font class="keywordtype">float</font> factorY,
00129                       <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;S&gt; &amp; src,
00130                       <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; target)<font class="keyword"></font>{
00131   
00132   <a class="code" href="class_XVSize.html">XVSize</a> targSize((round (src.Width() * factorX)), 
00133             (round(src.Height() * factorY)));
00134   target.resize(targSize);
00135 
00136   XVRowIterator&lt;S&gt;  srcIter (src);
00137   XVRowWIterator&lt;T&gt; targIter (target);
00138 
00139   <font class="keywordtype">float</font> addXf = 1 / factorX;
00140   <font class="keywordtype">float</font> addYf = 1 / factorY;
00141 
00142   <font class="comment">// use fast version if possible</font>
00143   <font class="keywordflow">if</font>((addXf - ((<font class="keywordtype">int</font>)addXf)) == 0 &amp;&amp; (addYf - ((<font class="keywordtype">int</font>)addYf)) == 0){
00144 
00145     <font class="keywordtype">int</font> addX = (<font class="keywordtype">int</font>)addXf;  <font class="keywordtype">int</font> addY = (<font class="keywordtype">int</font>)addYf;
00146 
00147     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> r = 0, sr = 0; r &lt; target.Height(); ++r, sr += addY){
00148       targIter.reset( r );
00149       srcIter.reset( sr );
00150       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> c = 0; !targIter.end(); ++targIter, srcIter += addX){   
00151      *targIter = <font class="keyword">static_cast</font>&lt;T&gt;(*srcIter);
00152       }
00153     }
00154   }<font class="keywordflow">else</font>{
00155 
00156     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> r = 0; r &lt; target.Height(); ++r) {
00157       targIter.reset( r );
00158       srcIter.reset( (<font class="keywordtype">int</font>)round(r/factorY) );      
00159       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> c = 0, nc = 0, pc = 0; !targIter.end(); ++targIter, 
00160                                                         ++c, 
00161                                                    nc = round(c / factorX),
00162                                                    srcIter += nc - pc,
00163                                                         pc = nc){
00164 
00165      *targIter = <font class="keyword">static_cast</font>&lt;T&gt;(*srcIter);
00166       }
00167     }
00168   }
00169 
00170   <font class="keywordflow">return</font> target;
00171 };
00172   
00173 
00174 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00175 <font class="keyword">inline</font> T subimage (<font class="keyword">const</font> T &amp; x, <font class="keyword">const</font> <a class="code" href="class_XVImageGeneric.html">XVImageGeneric</a> &amp; subim)<font class="keyword"></font>{
00176   T temp(x);
00177   temp.setSubImage(subim);
00178   <font class="keywordflow">return</font> temp;
00179 };
00180 
00181 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00182 <font class="keyword">inline</font> T subimage (<font class="keyword">const</font> T &amp;x, <font class="keyword">const</font> <a class="code" href="class_XVSize.html">XVSize</a> &amp;s, <font class="keyword">const</font> XVPosition &amp;p)<font class="keyword"></font>{
00183   <font class="keywordflow">return</font> subimage(x,XVImageGeneric(s,p));
00184 };
00185 
00186 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00187 <font class="keyword">inline</font> T subimage (<font class="keyword">const</font> T &amp;x, <font class="keyword">const</font> <font class="keywordtype">int</font> posx, <font class="keyword">const</font> <font class="keywordtype">int</font> posy, 
00188              <font class="keyword">const</font> <font class="keywordtype">int</font> w, <font class="keyword">const</font> <font class="keywordtype">int</font> h)<font class="keyword"> </font>{
00189   <font class="keywordflow">return</font> subimage(x,XVImageGeneric(XVSize(w,h), XVPosition(posx,posy)));
00190 };
00191 
00192 
00195 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00196 <font class="keyword">inline</font> ostream &amp; operator &lt;&lt; (ostream &amp; output, <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp; x)<font class="keyword"> </font>{
00197   XVImageIterator&lt;T&gt; iter(x);
00198   <font class="keywordflow">for</font> (;iter.end() == <font class="keyword">false</font>; output&lt;&lt;endl) 
00199     <font class="keywordflow">for</font> (<font class="keywordtype">int</font> i=0; i &lt; x.Width(); ++i, ++iter) {
00200       output.width(11);
00201       output&lt;&lt;*iter&lt;&lt;<font class="stringliteral">" "</font>;
00202     }
00203   <font class="keywordflow">return</font> output;
00204 }
00205 
00206 <font class="keyword">inline</font> ostream &amp; operator &lt;&lt; (ostream &amp; output, <font class="keyword">const</font> XVPosition &amp; x)<font class="keyword"> </font>{
00207   <font class="keywordflow">return</font> output &lt;&lt; <font class="stringliteral">"["</font> &lt;&lt; x.PosX() &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; x.PosY() &lt;&lt; <font class="stringliteral">"]"</font> &lt;&lt; endl;
00208 }
00209 
00210 <font class="keyword">inline</font> ostream &amp; operator &lt;&lt; (ostream &amp; output, <font class="keyword">const</font> <a class="code" href="class_XVSize.html">XVSize</a> &amp; x)<font class="keyword"> </font>{
00211   <font class="keywordflow">return</font> output &lt;&lt; <font class="stringliteral">"["</font> &lt;&lt; x.Width() &lt;&lt; <font class="stringliteral">", "</font> &lt;&lt; x.Height() &lt;&lt; <font class="stringliteral">"]"</font> &lt;&lt; endl;
00212 }
00213 
00218 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00219 ostream &amp; operator &lt;&lt; (ostream &amp;, <font class="keyword">const</font> <a class="code" href="class_XVImageBase.html">XVImageBase</a>&lt;T&gt; &amp;);
00220 
00221 ostream &amp; operator &lt;&lt; (ostream &amp;, <font class="keyword">const</font> XVPosition &amp;);
00222 ostream &amp; operator &lt;&lt; (ostream &amp;, <font class="keyword">const</font> <a class="code" href="class_XVSize.html">XVSize</a> &amp;);
00223 
00224 <font class="preprocessor">#endif
</font></div></pre><hr><address><small>Generated at Fri Oct 26 00:17:16 2007 for XVision by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
