<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/burschka/XVision2-2.0.0/src/Devices/XVVideo.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.0 on Fri Oct 26 00:17:16 2007 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/home/burschka/XVision2-2.0.0/src/Devices/XVVideo.h</h1><div class="fragment"><pre>00001 <font class="comment">// *** BEGIN_XVISION2_COPYRIGHT_NOTICE ***</font>
00002 <font class="comment">// *** END_XVISION2_COPYRIGHT_NOTICE ***</font>
00003 
00004 <font class="preprocessor">#ifndef _XVVIDEO_H_
</font>00005 <font class="preprocessor"></font><font class="preprocessor">#define _XVVIDEO_H_
</font>00006 <font class="preprocessor"></font>
00007 <font class="preprocessor">#include &lt;stdlib.h&gt;</font>
00008 <font class="preprocessor">#include "XVImageRGB.h"</font>
00009 <font class="preprocessor">#include "XVImageYUV.h"</font>
00010 
00011 <font class="keyword">typedef</font> <font class="keyword">enum</font> {MODE_CAP_SINGLE = 0, MODE_CAP_CONTINUOUS = 1}       XVCapture_Mode;
00012 <font class="keyword">typedef</font> <font class="keyword">enum</font> {NORM_NTSC=0,NORM_PAL,NORM_SECAM, INPUT_DETERMINED}  XV_Video_Norms;
00013 <font class="keyword">typedef</font> <font class="keyword">enum</font> {FULL_SIZE, HALF_SIZE, QUARTER_SIZE}                 XV_Resolution;
00014 
00015 <font class="comment">// XVSize is defined in XVImageBase.h</font>
00016 
00017 <font class="keyword">extern</font> <a class="code" href="class_XVSize.html">XVSize</a> XVSize_AVI_full,
00018   XVSize_NTSC_full,
00019   XVSize_NTSC_half,
00020   XVSize_NTSC_quarter;
00021 
00022 <font class="comment">//</font>
00023 <font class="keyword">typedef</font> <font class="keyword">struct
</font>00024 <font class="keyword"></font>{
00025    <font class="keywordtype">char</font>   c;             <font class="comment">// parameter specification e.g. B</font>
00026    <font class="keywordtype">int</font>  val;             <font class="comment">// assigned value</font>
00027 }XVParser;
00028 
00038 <font class="keyword">template</font> &lt;<font class="keyword">class </font>IMTYPE&gt;
<a name="l00039"></a><a class="code" href="class_XVVideo.html">00039</a> <font class="keyword">class </font><a class="code" href="class_XVVideo.html">XVVideo</a> {
00040 
00041 <font class="keyword">protected</font>:
00042 
00043   <font class="keyword">const</font> <font class="keywordtype">char</font>     *name;
00044   <a class="code" href="class_XVSize.html">XVSize</a>          size;
00045 
00046   <font class="comment">// By default, it is assumed that any video device might use multiple</font>
00047   <font class="comment">// buffers (e.g. a ring-buffer), so video provides basic support for</font>
00048   <font class="comment">// managing them.</font>
00049 
00050   IMTYPE * image_buffers;
00051 
00052   <font class="keywordtype">int</font>               n_buffers;
00053   <font class="keywordtype">int</font>             current_buffer;
00054 
00055   <font class="comment">// This is the index of the most recently acquired frame. </font>
00056 
00057   <font class="keywordtype">int</font>             frame_count;
00058   XVCapture_Mode  capture_mode;
00059 
00060   <font class="comment">// Default creation of buffers to be used in open</font>
00061   
00062   IMTYPE * init_map(<a class="code" href="class_XVSize.html">XVSize</a> &amp;s, <font class="keywordtype">int</font> n_buffers);
00063 
00064   <font class="comment">// Some local buffer management...by default this is just a ring queue</font>
00065 
00066   <font class="keyword">virtual</font> <font class="keywordtype">int</font> next_buffer()<font class="keyword"> </font>{
00067     <font class="keywordflow">return</font> (current_buffer = (++current_buffer%=n_buffers));};
00068 
00069   <font class="comment">// parse through the param string, the resulting char * is</font>
00070   <font class="comment">// modified by each call</font>
00071   <font class="comment">//     return 1     - got parameters</font>
00072   <font class="comment">//     return 0     - end of file</font>
00073   <font class="comment">//     return -1    - error</font>
00074   <font class="keywordtype">int</font>   parse_param(<font class="keywordtype">char</font> * &amp;paramstring,XVParser &amp;result);
00075 
00076   IMTYPE * frame_addr(<font class="keywordtype">int</font> i)<font class="keyword"> const </font>{
00077     ASSERT(i &lt; <a class="code" href="class_XVVideo.html#a2">buffer_count</a>());
00078     <font class="keywordflow">return</font> image_buffers+i;
00079   }
00080   <font class="comment">// describes if the buffers in XVImageRGB where created by Video</font>
00081   <font class="keywordtype">int</font>   own_buffers;
00082 
00083  <font class="keyword">public</font>:
00084 
00085   <font class="comment">/* This is the generic declaration of a video device and is what
</font>00086 <font class="comment">     the user would normally see when opening it.  The second
</font>00087 <font class="comment">     parameter is not used, but is here for reference since
</font>00088 <font class="comment">     most devices will probably want to pass a parameter string in
</font>00089 <font class="comment">     to get some default device configuration. */</font>
00090 
00091   XVVideo(<font class="keyword">const</font> <font class="keywordtype">char</font> *dev_name=<font class="stringliteral">"/dev/video"</font>, <font class="keyword">const</font> <font class="keywordtype">char</font> *parm_string = NULL);
00092 
00093   <font class="keyword">virtual</font> ~XVVideo();
00094 
<a name="l00097"></a><a class="code" href="class_XVVideo.html#a2">00097</a>   <font class="keywordtype">int</font>          <a class="code" href="class_XVVideo.html#a2">buffer_count</a>(<font class="keywordtype">void</font>)<font class="keyword"> const </font>{<font class="keywordflow">return</font> n_buffers;};
00098 
<a name="l00100"></a><a class="code" href="class_XVVideo.html#a3">00100</a>   IMTYPE &amp; <a class="code" href="class_XVVideo.html#a3">frame</a>(<font class="keywordtype">int</font> i)<font class="keyword"> const </font>{<font class="keywordflow">return</font> *(frame_addr(i));}
00101 
<a name="l00103"></a><a class="code" href="class_XVVideo.html#a4">00103</a>   IMTYPE &amp; <a class="code" href="class_XVVideo.html#a4">current_frame</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> <a class="code" href="class_XVVideo.html#a3">frame</a>((current_buffer-1+n_buffers)%n_buffers);}
00104   
<a name="l00106"></a><a class="code" href="class_XVVideo.html#a5">00106</a>   <font class="keywordtype">int</font> <a class="code" href="class_XVVideo.html#a5">current_buffer_number</a>()<font class="keyword"> const </font>{<font class="keywordflow">return</font> current_buffer;};
00107 
00113   <font class="keyword">virtual</font> <font class="keywordtype">int</font>  <a class="code" href="class_XVVideo.html#a6">initiate_acquire</a>(<font class="keywordtype">int</font> buffernum)=0;
00114   <font class="keyword">virtual</font> <font class="keywordtype">int</font>  wait_for_completion(<font class="keywordtype">int</font> buffernum)=0;
00115   <font class="keywordtype">int</font>          release_buffer(<font class="keywordtype">int</font> buffernum)<font class="keyword"></font>{ <font class="keywordflow">return</font> 0; };
00116 
<a name="l00122"></a><a class="code" href="class_XVVideo.html#a9">00122</a>   <font class="keywordtype">int</font> &amp; <a class="code" href="class_XVVideo.html#a9">request_frame_continuous</a>(<font class="keywordtype">int</font> framenum)<font class="keyword"> </font>{
00123     <font class="keywordflow">while</font> (frame_count &lt; framenum)
00124       next_frame_continuous();
00125 
00126     <font class="keywordflow">return</font> frame_count;
00127   }
00128 
00129   IMTYPE &amp; next_frame_continuous()<font class="keyword"> </font>{
00130     <font class="keywordflow">if</font> (capture_mode != MODE_CAP_CONTINUOUS) {<font class="comment">// Start the cycle</font>
00131       capture_mode = MODE_CAP_CONTINUOUS;
00132       <a class="code" href="class_XVVideo.html#a6">initiate_acquire</a>(current_buffer);
00133     }
00134     <font class="keywordtype">int</font> temp = current_buffer;
00135     <a class="code" href="class_XVVideo.html#a6">initiate_acquire</a>(next_buffer());
00136     wait_for_completion(temp);
00137     frame_count++;
00138     <font class="keywordflow">return</font> <a class="code" href="class_XVVideo.html#a3">frame</a>(temp);
00139   }
00140 
<a name="l00144"></a><a class="code" href="class_XVVideo.html#a11">00144</a>   <font class="keywordtype">int</font> <a class="code" href="class_XVVideo.html#a11">request_frame_poll</a>(<font class="keywordtype">int</font> framenum)<font class="keyword"> </font>{
00145     <font class="keywordtype">int</font> next;
00146 
00147     <font class="keywordflow">if</font> (capture_mode != MODE_CAP_SINGLE) {
00148       wait_for_completion(current_buffer);
00149       capture_mode = MODE_CAP_SINGLE;
00150       frame_count++;
00151     }
00152     <font class="keywordflow">while</font> (framenum &gt; frame_count) {
00153       <a class="code" href="class_XVVideo.html#a6">initiate_acquire</a>(next=next_buffer());
00154       wait_for_completion(next);
00155       frame_count++;
00156     }
00157     <font class="keywordflow">return</font> (current_buffer);
00158   };
00159 
00160   <font class="keyword">const</font> IMTYPE &amp; next_frame_poll(<font class="keywordtype">void</font>)<font class="keyword">
</font>00161 <font class="keyword">  </font>{
00162     <font class="keywordflow">if</font> (<a class="code" href="class_XVVideo.html#a11">request_frame_poll</a>(frame_count++))
00163       <font class="keywordflow">return</font> <a class="code" href="class_XVVideo.html#a4">current_frame</a>();
00164   }
00165 
00166   <font class="comment">//*** hardware device functions that need to be implemented for</font>
00167   <font class="comment">//*** any device</font>
00168 
00169   <font class="comment">// paramstring content</font>
00170   <font class="comment">// Bxx     - xx number of available buffers</font>
00171   <font class="comment">// I[0-2]  - input number</font>
00172   <font class="comment">// N[0-..] - norm XV_Video_Norms</font>
00173   <font class="comment">// S[1-2]  - full size, half size...</font>
00174   <font class="keyword">virtual</font> <font class="keywordtype">int</font>  set_params(<font class="keywordtype">char</font> *paramstring) = 0;
00175   <font class="comment">// This allow remapping of video buffers --- for example the</font>
00176   <font class="comment">// buffering class manages it's own; many framegrabber remap memory, etc.</font>
00177 
00178   IMTYPE * remap(<font class="keyword">typename</font> IMTYPE::PIXELTYPE * mm_buf[],<font class="keywordtype">int</font> n_buffers);
00179 
00180   <font class="comment">// added by Donald: whether the last acquired image from device is </font>
00181   <font class="comment">// valid or not (not necessarily equivalent to the last image the</font>
00182   <font class="comment">// appilcation gets from a XVVideo derived object, but a good indicator)</font>
00183   <font class="comment">// not yet implemented in derived classes so don't rely on it</font>
00184 
00185   <font class="keyword">virtual</font> <font class="keywordtype">bool</font> good(<font class="keywordtype">void</font>)<font class="keyword"> </font>{ <font class="keywordflow">return</font> <font class="keyword">true</font> ; }
00186 };
00187 <font class="preprocessor">#endif
</font>00188 <font class="preprocessor"></font>
00189 
00190 
00191 
00192 
00193 
00194 
00195 
00196 
00197 
00198 
00199 
00200 
00201 
00202 
00203 
00204 
00205 
</div></pre><hr><address><small>Generated at Fri Oct 26 00:17:16 2007 for XVision by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
