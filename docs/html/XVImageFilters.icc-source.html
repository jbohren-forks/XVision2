<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta name="robots" content="noindex">
<meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>/home/burschka/XVision2-2.0.0/src/Images/XVImageFilters.icc Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body bgcolor="#ffffff">
<!-- Generated by Doxygen 1.2.0 on Fri Oct 26 00:17:16 2007 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; </center>
<hr><h1>/home/burschka/XVision2-2.0.0/src/Images/XVImageFilters.icc</h1><div class="fragment"><pre>00001 <font class="comment">// *** BEGIN_XVISION2_COPYRIGHT_NOTICE ***</font>
00002 <font class="comment">// *** END_XVISION2_COPYRIGHT_NOTICE ***</font>
00003 
00004 <font class="preprocessor">#ifndef _XVIMAGEFILTERS_ICC_
</font>00005 <font class="preprocessor"></font><font class="preprocessor">#define _XVIMAGEFILTERS_ICC_
</font>00006 <font class="preprocessor"></font>
00007 <font class="preprocessor">#include &lt;XVImageIterator.h&gt;</font>
00008 <font class="preprocessor">#include &lt;XVMacros.h&gt;</font>
00009 
00010 <font class="preprocessor">#include &lt;iostream&gt;</font>
00011 
00012 
00021 <font class="keyword">template</font> &lt;<font class="keyword">class </font>SRCPIX, <font class="keyword">class </font>TRGPIX, <font class="keyword">class </font>MASKPIX&gt;
00022 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;TRGPIX&gt; &amp; convolve (<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;SRCPIX&gt; &amp;src,
00023                                      <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;TRGPIX&gt; &amp; targ, 
00024                       <font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;MASKPIX&gt; &amp; mask, 
00025                                <font class="keywordtype">float</font> norm)<font class="keyword"> 
</font>00026 <font class="keyword"></font>{
00027   
00028   ASSERT (mask.Width() &lt;= src.Width());
00029   ASSERT (mask.Height() &lt;= src.Height());
00030 
00031   targ.resize(src.Width() - mask.Width() + 1, 
00032            src.Height() - mask.Height() + 1);
00033   
00034   XVImageIterator&lt;SRCPIX&gt; srcIter (src, mask.Width(), mask.Height());
00035   XVImageIterator&lt;MASKPIX&gt; maskIter(mask);
00036   XVImageWIterator&lt;TRGPIX&gt; targIter(targ);
00037 
00038   <font class="keywordflow">for</font> (; !targIter.end(); ++targIter) {
00039 
00040     <font class="comment">/* set the position of the srcIter to the targIter 
</font>00041 <font class="comment">     * note that the srcIter's pointers must *all* be recalc'd  
</font>00042 <font class="comment">     */</font>
00043     srcIter.init_ptrs(src, mask.Width(), mask.Height(),
00044                       targIter.currposx(),targIter.currposy());
00045 
00046     *targIter = 0;
00047 
00048     <font class="keywordflow">for</font> (; !maskIter.end(); ++maskIter, ++srcIter)     
00049       *targIter += (*maskIter) * (*srcIter);
00050     
00051     maskIter.moveBy (0, -mask.Height());
00052   }
00053 
00054   <font class="comment">//normalize if needed</font>
00055   <font class="keywordflow">if</font> (norm != 0) {
00056     targIter.moveBy (-targIter.currposx(), -targIter.currposy());
00057     <font class="keywordflow">while</font> (!targIter.end()) {
00058       *targIter = <font class="keyword">static_cast</font>&lt;TRGPIX&gt;(*targIter/norm);
00059       ++targIter;
00060     }
00061   } 
00062 
00063   <font class="keywordflow">return</font> (targ);
00064 }
00065 
00066 <font class="keyword">template</font>&lt;<font class="keyword">class </font>T&gt;
00067 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; convolve( <font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, 
00068                                    <font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; mask )<font class="keyword"> </font>{
00069   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; result;
00070   <font class="keywordflow">return</font> convolve( image, result, mask, 0 );
00071 }
00072 
00073 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00074 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVPrewittFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp; image, T normalizer = (T)2, <font class="keywordtype">int</font> width = 2) {
00075   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1, 1);
00076   <font class="keywordflow">return</font> XVPrewittFilterX(image,normalizer, width, targ);
00077 }
00078 
00079 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00080 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVPrewittFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword"> </font>{
00081   <font class="keywordflow">return</font> XVPrewittFilterX(image,(T1)2, 2, targ);
00082 }
00083 
00084 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00085 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; XVPrewittFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, 
00086                            T1 normalizer, <font class="keywordtype">int</font> width, 
00087                            <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword"> </font>{
00088   <font class="comment">// Make sure image types follow the typing rules, and</font>
00089   <font class="comment">// that the image sizes make sense.  In this case, we're</font>
00090   <font class="comment">// taking differences, so the source must be unsigned</font>
00091 
00092   ASSERT (XVImage_Signed_Type(image.ImageType()));
00093   ASSERT (XVImage_Signed_Type(targ.ImageType()));
00094   ASSERT (image.ImageType() &lt;= targ.ImageType());
00095   ASSERT ((image.Height() &gt; 2) &amp;&amp; (image.Width() &gt; width));
00096   targ.resize(image.Width()-width,image.Height());
00097 
00098   XVRowWIterator&lt;T1&gt; targIter(targ);
00099   XVRowIterator&lt;T&gt; trail(image);
00100   XVRowIterator&lt;T&gt; lead(image);
00101 
00102   <font class="keywordflow">if</font> (normalizer == 0) { <font class="comment">//Differences</font>
00103     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00104       targIter.reset(j);
00105       trail.reset(j);
00106       lead.reset(j);
00107       lead += width;
00108       <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00109            *targIter = *lead - *trail;
00110       }
00111     }
00112   }
00113   <font class="keywordflow">else</font> {
00114     <font class="keywordflow">if</font> (targ.ImageType() &lt; XVImage_float) { <font class="comment">//Differences/2 with bias</font>
00115       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00116            targIter.reset(j);
00117            trail.reset(j);
00118            lead.reset(j);
00119            lead += width;
00120            <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00121              *targIter = (1 + *lead - *trail) / normalizer;
00122            }
00123       }
00124     } <font class="keywordflow">else</font> {
00125       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00126            targIter.reset(j);
00127            trail.reset(j);
00128            lead.reset(j);
00129            lead += width;
00130            <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00131              *targIter = (*lead - *trail) / normalizer;
00132            }
00133       }
00134     }
00135   }
00136 
00137   <font class="keywordflow">return</font> targ;
00138 };
00139 
00140 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00141 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVPrewittFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, T normalizer = (T)2, <font class="keywordtype">int</font> width = 2) {
00142   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1,1);
00143   <font class="keywordflow">return</font> XVPrewittFilterY(image,normalizer,width,targ);
00144 }
00145 
00146 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00147 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp; XVPrewittFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image,<a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword"> </font>{
00148   <font class="keywordflow">return</font> XVPrewittFilterY(image,(T1)2,2,targ);
00149 }
00150 
00151 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00152 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; XVPrewittFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, T1 normalizer, <font class="keywordtype">int</font> width, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword">
</font>00153 <font class="keyword"></font>{
00154   ASSERT (XVImage_Signed_Type(image.ImageType()));
00155   ASSERT (XVImage_Signed_Type(targ.ImageType()));
00156   ASSERT (image.ImageType() &lt;= targ.ImageType());
00157   ASSERT ((image.Height() &gt; width) &amp;&amp; (image.Width() &gt; 2));
00158 
00159   targ.resize(image.Width(),image.Height()-width);
00160 
00161   XVRowWIterator&lt;T1&gt; targIter(targ);
00162   XVRowIterator&lt;T&gt;   lead(image);
00163   XVRowIterator&lt;T&gt;   trail(image);
00164 
00165   <font class="keywordflow">if</font> (normalizer == (T1)0) {                <font class="comment">// Just compute differences</font>
00166     <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00167       targIter.reset(j);
00168       trail.reset(j);
00169       lead.reset(j+width);
00170       <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00171      *targIter = *lead - *trail;
00172       }
00173     }
00174   } <font class="keywordflow">else</font> {
00175     <font class="keywordflow">if</font>(targ.ImageType() &lt; XVImage_float) {
00176       T1 bias = normalizer/2;
00177       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00178      targIter.reset(j);
00179      trail.reset(j);
00180      lead.reset(j+width);
00181      <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00182        *targIter = (bias + *lead - *trail) / normalizer;
00183      }
00184       }
00185     } <font class="keywordflow">else</font> {
00186       <font class="keywordflow">for</font>(<font class="keywordtype">int</font> j = 0; j &lt; targ.Height(); ++j){
00187      targIter.reset(j);
00188      trail.reset(j);
00189      lead.reset(j+width);
00190      <font class="keywordflow">for</font>(; !targIter.end(); ++targIter, ++trail, ++lead){
00191        *targIter = (*lead - *trail) / normalizer;
00192      }
00193       }
00194     }
00195   }
00196 
00197   <font class="keywordflow">return</font> targ;
00198 };
00199 
00200 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00201 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVBoxFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width,   T norm = -1)<font class="keyword"> </font>{
00202   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1,1);
00203   <font class="keywordflow">return</font> XVBoxFilterX(image, width, norm, targ);
00204 }
00205 
00206 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00207 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; XVBoxFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, T1 norm, 
00208                           <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword"> </font>{ 
00209   ASSERT (image.Width() &gt;= width &amp;&amp; width&gt;1);
00210   targ.resize(image.Width()-width+1, image.Height());
00211   XVImageIterator&lt;T&gt; iterLead(image), iterTrail(image); 
00212   XVImageWIterator&lt;T&gt; iterTarg(targ);
00213   T1 sum, bias;  
00214   <font class="keywordtype">int</font> i, j;
00215 
00216   <font class="keywordflow">if</font> (norm &lt; 0) norm=width;
00217   <font class="keywordflow">if</font> (targ.ImageType() &lt; XVImage_float) bias=<font class="keyword">static_cast</font>&lt;T1&gt;(norm/2);
00218   <font class="keywordflow">else</font> bias=0;
00219 
00220   <font class="keywordflow">for</font> (i=0; i&lt;targ.Height(); i++) {
00221     *iterTarg=bias;
00222     <font class="keywordflow">for</font> (j=0; j&lt;width; ++j, ++iterLead) 
00223       *iterTarg += *iterLead;
00224     <font class="keywordflow">for</font> (; iterLead.currposx() &gt; 0; ++iterTrail, ++iterLead) {
00225       sum = *iterTarg;
00226       ++iterTarg;
00227       *iterTarg = *iterLead - *iterTrail + sum;
00228     }
00229     ++iterTarg;
00230     <font class="keywordflow">while</font> (iterTrail &lt; iterLead) ++iterTrail;
00231   } 
00232 
00233   iterTarg.close();
00234   
00235   <font class="comment">//normalize if needed</font>
00236   <font class="keywordflow">if</font> (norm != 0) {
00237     XVImageWIterator&lt;T&gt; iterNorm(targ);
00238     <font class="keywordflow">for</font>(; !iterNorm.end();  ++iterNorm){
00239       *iterNorm = <font class="keyword">static_cast</font>&lt;T&gt;(*iterNorm / norm);
00240     }
00241   }
00242   <font class="keywordflow">return</font>(targ);
00243 }
00244 
00245 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00246 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; XVBoxFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, T1 norm,
00247                          <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword"> 
</font>00248 <font class="keyword"></font>{
00249   ASSERT (image.Height() &gt;= width &amp;&amp; width&gt;1);
00250   targ.resize(image.Width(),image.Height()-width+1);
00251   XVImageIterator&lt;T&gt; iterLead(image), iterTrail(image), targTrail(targ); 
00252   XVImageWIterator&lt;T&gt; targLead(targ);
00253   T1 sum, bias;
00254   <font class="keywordtype">int</font> i, j;
00255   
00256   <font class="keywordflow">if</font> (norm &lt; 0) norm=width;
00257   <font class="keywordflow">if</font> (targ.ImageType() &lt; XVImage_float) bias=<font class="keyword">static_cast</font>&lt;T1&gt;(norm/2);
00258   <font class="keywordflow">else</font> bias=0;
00259 
00260   <font class="keywordflow">for</font> (i=0; i&lt;targ.Width(); ++i, ++iterLead, ++targLead)
00261     *targLead = *iterLead + bias/2;
00262   <font class="keywordflow">for</font> (i=1; i&lt;width; ++i) {
00263     targLead.moveBy(0,-1); 
00264     <font class="keywordflow">for</font> (j=0; j&lt;targ.Width(); ++j, ++targLead, ++iterLead)
00265       *targLead += *iterLead;
00266   }
00267   <font class="keywordflow">for</font> (i=1; i&lt;targ.Height(); ++i)
00268     <font class="keywordflow">for</font> (j=0;j&lt;targ.Width();++j,++targLead,++iterLead,++targTrail,++iterTrail)
00269       *targLead = *targTrail + *iterLead - *iterTrail;
00270 
00271   <font class="comment">//normalize if needed</font>
00272   <font class="keywordflow">if</font> (norm != 0){
00273     targLead.moveBy (-targLead.currposx(), -targLead.currposy());
00274      <font class="keywordflow">while</font> (targLead.end() == <font class="keyword">false</font>) {
00275        *targLead = <font class="keyword">static_cast</font>&lt;T1&gt;(*targLead/norm);
00276        ++targLead;
00277      }
00278   }
00279 
00280   <font class="keywordflow">return</font> (targ);
00281 }
00282 
00283 
00284 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00285 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVBoxFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, T norm = -1)<font class="keyword">
</font>00286 <font class="keyword"></font>{ 
00287   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1,1);
00288   <font class="keywordflow">return</font> (XVBoxFilterY(image,width,norm,targ));
00289 }
00290 
00291 
00292 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00293 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVBoxFilter(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height)<font class="keyword">   </font>{
00294   <font class="keywordflow">return</font> XVBoxFilterX(XVBoxFilterY(image,height,(T)0),width,(T)width*height);
00295 }
00296 
00297 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00298 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; XVBoxFilter(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword">
</font>00299 <font class="keyword"></font>{
00300   <font class="keywordflow">return</font> XVBoxFilterX(XVBoxFilterY(image,height,(T)0),width,(T1)width*height,targ);
00301 }
00302 
00303 
00304 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00305 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; XVBoxFilter(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, <font class="keywordtype">int</font> width, <font class="keywordtype">int</font> height, T1 normalizer, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T1&gt; &amp; targ)<font class="keyword">
</font>00306 <font class="keyword"></font>{
00307   <font class="keywordflow">if</font> (normalizer &lt; 0)
00308     normalizer = width*height;
00309 
00310   <font class="keywordflow">return</font> XVBoxFilterX(XVBoxFilterY(image,height,0),width,normalizer,targ);
00311 }
00312 
00313 <font class="preprocessor">#define max2(a,b)  (a&gt;b? a:b)
</font>00314 <font class="preprocessor"></font>
00315 <font class="preprocessor">#define ROBERTS_X 1
</font>00316 <font class="preprocessor"></font><font class="preprocessor">#define ROBERTS_Y 2
</font>00317 <font class="preprocessor"></font>
00318 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00319 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp; XVRobertsFilter(<a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp; src, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp; targ, T1 norm = 0, <font class="keywordtype">int</font> direc = ROBERTS_X)<font class="keyword"></font>{
00320 
00321   targ.resize(src.Width() - 1, src.Height() - 1);
00322   XVImageIterator&lt;T&gt; minusOneIter(src);
00323   XVImageIterator&lt;T&gt;  plusOneIter(src);
00324 
00325   <font class="keywordflow">if</font>(direc == ROBERTS_X){
00326     <font class="comment">//XVImageIterator&lt;T&gt; minusOneIter(src, src.Width() - 1, src.Height() - 1, 0, 1);</font>
00327     <font class="comment">//XVImageIterator&lt;T&gt;  plusOneIter(src, src.Width() - 1, src.Height() - 1, 1, 0);</font>
00328     minusOneIter.init_ptrs(src, src.Width() - 1, src.Height() - 1, 0, 1);
00329      plusOneIter.init_ptrs(src, src.Width() - 1, src.Height() - 1, 1, 0);
00330 
00331   }<font class="keywordflow">else</font>{
00332     <font class="comment">//XVImageIterator&lt;T&gt; minusOneIter(src, src.Width() - 1, src.Height() - 1, 1, 1);</font>
00333     <font class="comment">//XVImageIterator&lt;T&gt;  plusOneIter(src, src.Width() - 1, src.Height() - 1, 0, 0);</font>
00334     minusOneIter.init_ptrs(src, src.Width() - 1, src.Height() - 1, 1, 1);
00335      plusOneIter.init_ptrs(src, src.Width() - 1, src.Height() - 1, 0, 0);
00336   }    
00337 
00338   XVImageWIterator&lt;T&gt; iter(targ);
00339   
00340   <font class="keywordflow">if</font>(norm == 0){  <font class="comment">// just take the differences</font>
00341 
00342     <font class="keywordflow">for</font>(; !iter.end(); ++iter, ++minusOneIter, ++plusOneIter){
00343       
00344       *iter = *plusOneIter - *minusOneIter;
00345     }
00346   }<font class="keywordflow">else</font>{
00347 
00348     T1 bias = norm / 2;
00349 
00350     <font class="keywordflow">for</font>(; !iter.end(); ++iter, ++minusOneIter, ++plusOneIter){
00351       
00352       *iter = (bias + *plusOneIter - *minusOneIter) / norm;
00353     }
00354   }
00355   <font class="keywordflow">return</font> targ;
00356 };
00357 
00358 
00359 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00360 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, T1* mask, 
00361  <font class="keywordtype">int</font> mask_size, T1 norm = 0, <font class="keywordtype">int</font> type=0)<font class="keyword">
</font>00362 <font class="keyword"></font>{
00363   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1,1);
00364   <font class="keywordflow">return</font> XVFilterX(image, targ, mask, mask_size, norm, type);
00365 }
00366 
00367 <font class="comment">//Note: type=0 means default target size: src.Heigt() - mask_size +1</font>
00368 <font class="comment">//      type=1 means returing full-size image </font>
00369 
00370 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt; 
00371 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; XVFilterX(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; src, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; targ,
00372    T1 * mask, <font class="keywordtype">int</font> mask_size, T1 norm=0, <font class="keywordtype">int</font> type=0 )<font class="keyword">
</font>00373 <font class="keyword"></font>{
00374   XVImageIterator&lt;T&gt;  srcIter (src);
00375   <font class="keywordtype">int</font> i, j, k, shift=(mask_size-1)/2;
00376 
00377   <font class="keywordflow">if</font>( type==0) {
00378     targ.resize(src.Width() - mask_size + 1, src.Height() );
00379     XVImageWIterator&lt;T&gt; targIter(targ);
00380     <font class="keywordflow">for</font>(j=0; j&lt;targ.Height(); ++j) {
00381       srcIter.move(0, j);
00382       targIter.move(0, j);
00383       <font class="keywordflow">for</font>( i=0; i&lt;targ.Width(); ++i, ++targIter, ++srcIter) {
00384         *targIter=0;
00385         <font class="keywordflow">for</font>( k=0; k&lt;mask_size-1; ++k, ++srcIter) *targIter+=mask[k] * (*srcIter);
00386         *targIter+=mask[k]*(*srcIter);
00387         srcIter.moveBy(-mask_size+1, 0);
00388       }
00389     } 
00390   }
00391   <font class="keywordflow">else</font>{
00392     targ.resize(src.Width(), src.Height() );
00393     XVImageWIterator&lt;T&gt; targIter(targ);
00394     <font class="keywordflow">for</font>(j=0; j&lt;targ.Height(); ++j) {
00395       targIter.move(0, j); 
00396 
00397       <font class="comment">//valid pos starts with 0 to i+shift</font>
00398       srcIter.move(0, j);
00399       <font class="keywordflow">for</font>(i=0; i&lt;shift; ++i, ++targIter ) {
00400         *targIter=0;
00401         <font class="keywordflow">for</font>(k= mask_size - (i+shift) -1; k&lt;mask_size-1; ++k, ++srcIter) 
00402           *targIter += mask[k] * (*srcIter);
00403         *targIter+=mask[k] * (*srcIter);
00404         srcIter.moveBy(-( i + shift ), 0 );
00405       }
00406        
00407       srcIter.move(0, j);
00408       <font class="keywordflow">for</font>(; i&lt;targ.Width()-shift; ++i, ++targIter, ++srcIter) {
00409         *targIter=0;
00410         <font class="keywordflow">for</font>( k=0; k&lt;mask_size-1; ++k, ++srcIter) *targIter+=mask[k] * (*srcIter);
00411 
00412         *targIter+=mask[k]* (*srcIter);
00413         srcIter.moveBy(-mask_size+1, 0);
00414       }
00415 
00416       srcIter.move(i-shift, j);
00417       <font class="comment">//valid pos starts with i-shift to targ.Width()-1</font>
00418       <font class="keywordflow">for</font>(; i&lt;targ.Width(); ++i, ++targIter ) {
00419          
00420         *targIter=0;
00421         <font class="keywordflow">for</font>(k=0; k&lt; targ.Width()-i+shift-1; ++k, ++srcIter) {
00422           *targIter += mask[k] * (*srcIter);
00423         }
00424         *targIter += mask[k] * (*srcIter);
00425         srcIter.moveBy(- (targ.Width()-i+shift-1), 0);
00426       }
00427     }
00428   }
00429 
00430   <font class="comment">//normalize if needed</font>
00431   <font class="keywordflow">if</font> (norm != 0) {
00432     XVImageWIterator&lt;T&gt; targIter2(targ);
00433     <font class="keywordflow">while</font> (!targIter2.end()) {
00434       *targIter2 = <font class="keyword">static_cast</font>&lt;T&gt;(*targIter2/norm);
00435       ++targIter2;
00436     }
00437   } 
00438 
00439   <font class="keywordflow">return</font> (targ);
00440 }
00441 
00442 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt;
00443 <font class="keyword">inline</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; XVFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; &amp;image, T1* mask, 
00444  <font class="keywordtype">int</font> mask_size, T1 norm = 0, <font class="keywordtype">int</font> type=0)<font class="keyword">
</font>00445 <font class="keyword"></font>{
00446   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; targ(1,1);
00447   <font class="keywordflow">return</font> XVFilterY(image, targ, mask, mask_size, norm, type);
00448 }
00449 
00450 <font class="comment">//Note: type=0 means default target size: src.Heigt() - mask_size +1</font>
00451 <font class="comment">//      type=1 means full-size filter</font>
00452 
00453 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T, <font class="keyword">class </font>T1&gt; 
00454 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; XVFilterY(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; src, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; targ, T1 * mask, 
00455   <font class="keywordtype">int</font> mask_size, T1 norm=0, <font class="keywordtype">int</font> type=0 )<font class="keyword">
</font>00456 <font class="keyword"></font>{
00457   <font class="keywordtype">int</font> i, j, k, shift=( mask_size - 1 )/2;
00458   XVImageIterator&lt;T&gt;  srcIter (src);
00459 
00460   <font class="keywordflow">if</font>( type==0 ) {
00461 
00462     targ.resize(src.Width(), src.Height() - mask_size + 1 );
00463     XVImageWIterator&lt;T&gt; targIter(targ);
00464 
00465     <font class="keywordflow">for</font>(j=0; j&lt;targ.Height(); ++j) {
00466 
00467       srcIter.move (0, j);
00468       targIter.move(0, j);
00469       <font class="keywordflow">for</font>(i=0; i&lt;targ.Width(); ++i, ++targIter, ++srcIter) {
00470 
00471         *targIter=0;
00472         <font class="keywordflow">for</font>(k=0; k&lt;mask_size-1; ++k) {
00473           *targIter += mask[k] * (*srcIter);
00474           srcIter.moveBy(0,1);
00475         }
00476         *targIter += mask[k] * (*srcIter);
00477         srcIter.moveBy(0, -mask_size+1);
00478       }
00479     } 
00480   }
00481   <font class="keywordflow">else</font>{
00482     targ.resize(src.Width(), src.Height() );
00483     XVImageWIterator&lt;T&gt; targIter(targ);
00484 
00485     <font class="keywordflow">for</font>(j=0; j&lt;shift; ++j) {
00486       srcIter.move (0, 0);
00487       targIter.move(0, j);
00488  
00489       <font class="comment">//valid pos starts with 0 to j+shift</font>
00490       <font class="keywordflow">for</font>(i=0; i&lt;targ.Width(); ++i, ++targIter, ++srcIter) {
00491         *targIter=0;
00492         <font class="keywordflow">for</font>(k= mask_size - (j+shift) -1; k&lt; mask_size-1; ++k) {
00493           *targIter += mask[k] * (*srcIter);
00494           srcIter.moveBy(0, 1);
00495         }
00496         *targIter += mask[k] * (*srcIter);
00497         srcIter.moveBy(0, -( j + shift ) );
00498       }
00499     }
00500     <font class="keywordflow">for</font>(j=shift; j&lt;targ.Height()-shift; ++j) {
00501       srcIter.move (0, j-shift);
00502       targIter.move(0, j);
00503 
00504       <font class="keywordflow">for</font>(i=0; i&lt;targ.Width(); ++i, ++targIter, ++srcIter) {
00505         *targIter=0;
00506         <font class="keywordflow">for</font>(k=0; k&lt;mask_size-1; ++k) {
00507           *targIter += mask[k] * (*srcIter);
00508           srcIter.moveBy(0,1);
00509         }
00510         *targIter += mask[k] * (*srcIter);
00511         srcIter.moveBy(0, -(mask_size-1) );
00512       }
00513     }
00514 
00515     <font class="keywordflow">for</font>(j=targ.Height()-shift; j&lt;targ.Height(); ++j) {
00516 
00517       <font class="comment">//valid pos starts with j-shift to targ.Height()-1</font>
00518       srcIter.move(0, j-shift);
00519       targIter.move(0, j);
00520 
00521       <font class="keywordflow">for</font>(i=0; i&lt;targ.Width(); ++i, ++targIter, ++srcIter) {
00522         *targIter=0;
00523         <font class="keywordflow">for</font>(k=0; k&lt;targ.Height()-j + shift-1; ++k) {
00524           *targIter += mask[k] * (*srcIter);
00525           srcIter.moveBy(0,1);
00526         }
00527         *targIter+=mask[k] * (*srcIter);
00528         srcIter.moveBy(0, -( targ.Height() - j + shift -1 ) );
00529       }
00530     }
00531   }
00532 
00533   <font class="comment">//normalize if needed</font>
00534   
00535   <font class="keywordflow">if</font> (norm != 0) {
00536     XVImageWIterator&lt;T&gt; targIter2(targ);
00537     <font class="keywordflow">while</font> (!targIter2.end()) {
00538       *targIter2 = <font class="keyword">static_cast</font>&lt;T&gt;(*targIter2/norm);
00539       ++targIter2;
00540     }
00541   } 
00542 
00543   <font class="keywordflow">return</font> (targ);
00544 }
00545 
00546 <font class="keyword">template</font> &lt;<font class="keyword">class </font>T&gt;
00547 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; XVGaussFilter(<font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; src, <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; targ, 
00548   <font class="keywordtype">float</font> sigma, <font class="keywordtype">int</font> size, <font class="keywordtype">int</font> type=0)<font class="keyword">
</font>00549 <font class="keyword"></font>{
00550   <font class="keywordflow">if</font>( size == 0 ) {
00551     size=ceil( 3*sigma);
00552     <font class="keywordflow">if</font>( size%2 ==0 ) size +=1;
00553   }
00554 
00555   <font class="comment">//compute the kernel</font>
00556   <font class="keywordtype">float</font> coef[16];
00557   <font class="keywordtype">int</font> parm[16];
00558   <font class="keywordtype">int</font> w=(size-1)/2;
00559 
00560   <font class="keywordtype">int</font> i, j, k;
00561   <font class="keywordtype">float</font> min_coef=1.0;
00562 
00563   <font class="comment">//sampling the Gaussian</font>
00564   <font class="keywordflow">for</font>( i=0; i&lt;size; ++i) {
00565     j = -w + i;
00566     k = -j *j;
00567     coef[i] =exp( k/(2*sigma*sigma) );
00568     <font class="keywordflow">if</font>(coef[i]&lt;min_coef) min_coef=coef[i];
00569   }
00570 
00571   <font class="comment">//compute discrete kernel and normalizer</font>
00572   k=0;
00573   <font class="keywordflow">for</font>( i=0; i&lt;size; ++i) {
00574     parm[i] =round (coef[i]/min_coef);
00575     k+=parm[i]; 
00576   }
00577 
00578   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; temp(1,1);
00579 
00580   XVFilterY(src,  temp, parm, size, k, type);
00581   XVFilterX(temp, targ, parm, size, k, type);
00582   <font class="keywordflow">return</font> targ;
00583 
00584   <font class="comment">//return XVFilterX( XVFilterY(src, parm, size,k, type), targ, parm, size, k, type);</font>
00585 }
00586 
00587 <font class="keyword">template</font>&lt;<font class="keyword">class </font>T&gt;
00588 <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; XVGaussFilter( <font class="keyword">const</font> <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt;&amp; image, <font class="keywordtype">float</font> sigma, <font class="keywordtype">int</font> size, <font class="keywordtype">int</font> type=0)<font class="keyword">
</font>00589 <font class="keyword"></font>{
00590   <a class="code" href="class_XVImageScalar.html">XVImageScalar</a>&lt;T&gt; result(1,1);
00591   <font class="keywordflow">return</font> XVGaussFilter(image, result, sigma, size, type);
00592 }
00593 
00594 <font class="preprocessor">#endif
</font></div></pre><hr><address><small>Generated at Fri Oct 26 00:17:16 2007 for XVision by
<a href="http://www.stack.nl/~dimitri/doxygen/index.html">
<img src="doxygen.gif" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.2.0 written by <a href="mailto:dimitri@stack.nl">Dimitri van Heesch</a>,
 &copy;&nbsp;1997-2000</small></address>
</body>
</html>
